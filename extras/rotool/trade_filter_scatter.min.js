$(function(){(()=>{let t={datasets:[{label:"",data:[]}]},e=null;$.getScript("https://cdn.jsdelivr.net/npm/chart.js",()=>{$.getScript("https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns",()=>{$("#trade_log").before('<canvas id="trade_scatter"></canvas>'),e=new Chart(document.getElementById("trade_scatter").getContext("2d"),{type:"scatter",data:t,options:{scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"yyyy-MM-dd HH:mm",displayFormats:{day:"yyyy-MM-dd"}},title:{display:!0,text:"日時"}},y:{title:{display:!0,text:"単価"}}},plugins:{legend:{display:!1}}}}),$("#extras_ro_card_enchant_select").change()})}),$(".card_flg:last").parent().after('<select id="extras_ro_card_enchant_select" style="color:#666;margin-left:0.5em;padding: 0.4em 1em; border-radius: 20px;"><option value=""></option></select>');let a=()=>{$("#extras_ro_card_enchant_select option").remove(),$("#extras_ro_card_enchant_select").append($("<option>").val("none").text(""));let t=$(".conent-ttl").text(),e=new Set;$("#Normal_Coefficient > table > tbody > tr > td:first-child > div").each((a,n)=>{-1==$(n).text().indexOf(t)&&e.add($(n).text())}),e.forEach(t=>{$("#extras_ro_card_enchant_select").append($("<option>").val(t).text(t))})};$(document).on("change","#extras_ro_card_enchant_select",t=>{let a=$(t.target).val(),n=[],r=[];$("#Normal_Coefficient > table > tbody > tr").each((t,e)=>{if("none"!=a&&0>$("td:first-child > div",e).text().indexOf(a))$(e).hide();else{$(e).show(),$("td",e),n.push(parseInt($($("td",e)[1]).text().replaceAll(",","").replace("zeny","")));let l={x:"",y:0};l.y=parseInt($($("td",e)[1]).text().replaceAll(",","").replace("zeny","")),l.x=new Date($($("td",e)[3]).text().replace(" ","T")),r.push(l)}}),n.length&&(n.sort((t,e)=>t-e),half=(n.length%2?n.length-1:n.length)/2,$(".median_price .money").text(`${n[half].toLocaleString()}zeny`),$(".min_price .money").text(`${n[0].toLocaleString()}zeny`),$(".max_price .money").text(`${n[n.length-1].toLocaleString()}zeny`)),e&&(e.data.datasets[0].data=r,e.update())});let n=()=>{if($("#trade_log>*:first").data("loading")){setTimeout(n,500);return}a(),$("#extras_ro_card_enchant_select").trigger("change")};$(".item_filter input[type=checkbox]").click(()=>{$("#trade_log>*:first").data("loading","loading"),n()}),n()})()});
