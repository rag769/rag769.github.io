$(function(){(()=>{let e={datasets:[{label:"",data:[]}]},t=null;$.getScript("https://cdn.jsdelivr.net/npm/chart.js",()=>{$.getScript("https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns",()=>{$("#trade_log").before('<canvas id="trade_scatter"></canvas>'),t=new Chart(document.getElementById("trade_scatter").getContext("2d"),{type:"scatter",data:e,options:{scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"yyyy-MM-dd HH:mm",displayFormats:{day:"yyyy-MM-dd"}},title:{display:!0,text:"日時"}},y:{title:{display:!0,text:"単価"}}},plugins:{legend:{display:!1}}}}),$("#extras_ro_card_enchant_select").change()})}),$(".card_flg:last").parent().after('<select id="extras_ro_card_enchant_select" style="color:#666;margin-left:0.5em;padding: 0.4em 1em; border-radius: 20px;"><option value=""></option></select>');let a=()=>{$("#extras_ro_card_enchant_select option").remove(),$("#extras_ro_card_enchant_select").append($("<option>").val("none").text(""));let e=$(".conent-ttl").text(),t=new Set;$("#Normal_Coefficient > table > tbody > tr > td:first-child > div").each((a,n)=>{-1==$(n).text().indexOf(e)&&t.add($(n).text())}),Array.from(t).sort((e,t)=>(e=String(e).replace("%","").split("+"),t=String(t).replace("%","").split("+"),1==e.length||1==t.length||e[0]!=t[0])?e[0]<t[0]?-1:1:e[1]-t[1]).forEach(e=>{$("#extras_ro_card_enchant_select").append($("<option>").val(e).text(e))})};$(document).on("change","#extras_ro_card_enchant_select",e=>{let a=$(e.target).val(),n=[],r=[];$("#Normal_Coefficient > table > tbody > tr").each((e,t)=>{if("none"!=a&&0>$("td:first-child > div",t).text().indexOf(a))$(t).hide();else{$(t).show(),$("td",t),n.push(parseInt($($("td",t)[1]).text().replaceAll(",","").replace("zeny","")));let i={x:"",y:0};i.y=parseInt($($("td",t)[1]).text().replaceAll(",","").replace("zeny","")),i.x=new Date($($("td",t)[3]).text().replace(" ","T")),r.push(i)}}),$("#Noatun_Coefficient > table > tbody > tr").each((e,t)=>{"none"!=a&&0>$("td:first-child > div",t).text().indexOf(a)?$(t).hide():$(t).show()}),n.length&&(n.sort((e,t)=>e-t),half=(n.length%2?n.length-1:n.length)/2,$("#Normal_Coefficient_Summary .median_price .money").text(`${n[half].toLocaleString()}zeny`),$("#Normal_Coefficient_Summary .min_price .money").text(`${n[0].toLocaleString()}zeny`),$("#Normal_Coefficient_Summary .max_price .money").text(`${n[n.length-1].toLocaleString()}zeny`),$("#Noatun_Coefficient_Summary .median_price .money").text(`${Math.ceil(n[half]/1e3).toLocaleString()}zeny`),$("#Noatun_Coefficient_Summary .min_price .money").text(`${Math.ceil(n[0]/1e3).toLocaleString()}zeny`),$("#Noatun_Coefficient_Summary .max_price .money").text(`${Math.ceil(n[n.length-1]/1e3).toLocaleString()}zeny`)),t&&(t.data.datasets[0].data=r,t.update())});let n=()=>{if($("#trade_log>*:first").data("loading")){setTimeout(n,500);return}a(),$("#extras_ro_card_enchant_select").trigger("change")};$(".item_filter input[type=checkbox]").click(()=>{$("#trade_log>*:first").data("loading","loading"),n()}),n()})()});
