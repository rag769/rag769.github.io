$(function(){(()=>{if($("#extras_ro_card_enchant_select_box").length>0)return;let e=null;const t=["カード","アクエリアス","アリエス","ヴァルゴ","ヴァルゴの欠片","カプリコーン","キャンサー","サーペンタリウス","サジタリウス","ジェミニ","スコーピオ","タウロス","パイシーズ","リーブラ","レオ","レオの欠片","覇者の思念","魔神の幸運","魔神の集中","魔神の迅速","魔神の体力","魔神の知力","魔神の腕力"],n=()=>{const e=new Set,n=new Set,a=$(".conent-ttl").text();$("#Normal_Coefficient > table > tbody > tr:not([style*='display: none']) > td:first-child > div").each((o,r)=>{-1==$(r).text().indexOf(a)&&(t.find(e=>$(r).text().indexOf(e)>=0)?e.add($(r).text()):n.add($(r).text()))});const o=(e,t)=>(e=String(e).replace("%","").split("+"),t=String(t).replace("%","").split("+"),1==e.length||1==t.length||e[0]!=t[0]?e[0]<t[0]?-1:1:e[1]-t[1]);return[Array.from(e).sort(o),Array.from(n).sort(o)]},a=()=>{let e,t;[e,t]=n(),$("#extras_ro_card_enchant_select_box").remove(),e.length+t.length>0&&$(".card_flg:last").parent().after('<div id="extras_ro_card_enchant_select_box"><h4>フィルタ</h4></div>'),e.length>0&&($("#extras_ro_card_enchant_select_box").append('<select id="extras_ro_card_select" style="width:20em;color:#666;padding: 0.4em 1em; border-radius: 20px;border:1px solid;background:#fff"><option value="">カード指定なし</option><option value="nocard">カードなし</option></select>'),e.forEach(e=>{$("#extras_ro_card_select").append($("<option>").val(e).text(e))})),t.length>0&&($("#extras_ro_card_enchant_select_box").append('<select id="extras_ro_enchant_select" style="width:20em;color:#666;margin-left:0.5em;padding: 0.4em 1em; border-radius: 20px;border:1px solid;background:#fff"><option value="">エンチャント指定なし</option></select>'),t.forEach(e=>{$("#extras_ro_enchant_select").append($("<option>").val(e).text(e))}))},o=()=>{const n=$("#extras_ro_card_select").val()||"",a=$("#extras_ro_enchant_select").val()||"",o=[],r=[];if($("#Normal_Coefficient > table > tbody > tr").each((e,i)=>{let c="nocard"==n,l=!1;if($("td:first-child > div",i).each((e,o)=>{c="nocard"==n?c&&!t.find(e=>$(o).text().indexOf(e)>=0):c||$(o).text().indexOf(n)>=0,l=l||$(o).text().indexOf(a)>=0}),c&&l){$(i).show(),$($("#Noatun_Coefficient > table > tbody > tr")[e]).show();$("td",i);o.push(parseInt($($("td",i)[1]).text().replaceAll(",","").replace("zeny","")));const t={x:"",y:0};t.y=parseInt($($("td",i)[1]).text().replaceAll(",","").replace("zeny","")),t.x=new Date($($("td",i)[3]).text().replace(" ","T")),r.push(t)}else $(i).hide(),$($("#Noatun_Coefficient > table > tbody > tr")[e]).hide()}),o.length){o.sort((e,t)=>e-t);const e=(o.length%2?o.length-1:o.length)/2;$("#Normal_Coefficient_Summary .median_price .money").text(`${o[e].toLocaleString()}zeny`),$("#Normal_Coefficient_Summary .min_price .money").text(`${o[0].toLocaleString()}zeny`),$("#Normal_Coefficient_Summary .max_price .money").text(`${o[o.length-1].toLocaleString()}zeny`),$("#Noatun_Coefficient_Summary .median_price .money").text(`${Math.ceil(o[e]/1e3).toLocaleString()}zeny`),$("#Noatun_Coefficient_Summary .min_price .money").text(`${Math.ceil(o[0]/1e3).toLocaleString()}zeny`),$("#Noatun_Coefficient_Summary .max_price .money").text(`${Math.ceil(o[o.length-1]/1e3).toLocaleString()}zeny`)}else $("#Normal_Coefficient_Summary .median_price .money").text("N/A"),$("#Normal_Coefficient_Summary .min_price .money").text("N/A"),$("#Normal_Coefficient_Summary .max_price .money").text("N/A"),$("#Noatun_Coefficient_Summary .median_price .money").text("N/A"),$("#Noatun_Coefficient_Summary .min_price .money").text("N/A"),$("#Noatun_Coefficient_Summary .max_price .money").text("N/A");e&&(e.data.datasets[0].data=r,e.update())};$(document).on("change","#extras_ro_card_select,#extras_ro_enchant_select",o);const r=()=>{0==$("#trade_log>*:first").length||$("#trade_log>*:first").data("loading")?setTimeout(r,100):(a(),o())};$(".item_filter input[type=checkbox]").click(()=>{$("#trade_log>*:first").data("loading","loading"),r()}),r()})()});